Version 4
SHEET 1 2652 680
WIRE 560 -144 160 -144
WIRE 640 -144 560 -144
WIRE 720 -144 640 -144
WIRE 944 -144 816 -144
WIRE 1056 -144 944 -144
WIRE 1392 -144 1056 -144
WIRE 1632 -144 1392 -144
WIRE 1824 -144 1632 -144
WIRE 2000 -144 1824 -144
WIRE 2176 -144 2000 -144
WIRE 1632 -128 1632 -144
WIRE 944 -112 944 -144
WIRE 736 -64 736 -96
WIRE 736 -64 640 -64
WIRE 768 -64 736 -64
WIRE 864 -64 832 -64
WIRE 1056 -64 960 -64
WIRE 1824 -64 1824 -144
WIRE 2000 -64 2000 -144
WIRE 1056 -32 1056 -64
WIRE 1632 -32 1632 -48
WIRE 560 -16 560 -144
WIRE 560 -16 448 -16
WIRE 624 -16 560 -16
WIRE 1392 -16 1392 -144
WIRE 448 32 448 -16
WIRE 448 32 416 32
WIRE 400 48 400 32
WIRE 400 48 384 48
WIRE 624 48 560 48
WIRE 736 48 736 -64
WIRE 1824 48 1824 16
WIRE 1824 48 1680 48
WIRE 400 64 400 48
WIRE 448 64 416 64
WIRE 1056 80 1056 48
WIRE 1824 80 1824 48
WIRE 2176 80 2176 -144
WIRE 1248 112 1088 112
WIRE 1392 112 1392 64
WIRE 1392 112 1248 112
WIRE 2000 112 2000 16
WIRE 2000 112 1856 112
WIRE 448 128 448 64
WIRE 560 128 560 48
WIRE 560 128 528 128
WIRE 688 128 560 128
WIRE 160 144 160 -144
WIRE 1632 144 1632 64
WIRE 560 160 560 128
WIRE 2000 176 2000 112
WIRE 1344 192 1248 192
WIRE 1248 224 1248 192
WIRE 1632 256 1632 208
WIRE 1824 256 1824 144
WIRE 1824 256 1632 256
WIRE 2000 256 1824 256
WIRE 160 304 160 224
WIRE 560 304 560 240
WIRE 560 304 160 304
WIRE 736 304 736 144
WIRE 736 304 560 304
WIRE 1056 304 1056 144
WIRE 1056 304 736 304
WIRE 1104 304 1056 304
WIRE 1248 304 1184 304
WIRE 1392 304 1392 208
WIRE 1392 304 1248 304
WIRE 2176 304 2176 160
WIRE 2176 304 1392 304
WIRE 160 320 160 304
WIRE 1056 368 1056 304
WIRE 1824 368 1824 256
WIRE 1824 368 1056 368
FLAG 160 320 0
FLAG 2176 -144 VOUT
SYMBOL voltage 160 128 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName VIN
SYMATTR Value 5V
SYMBOL res 1376 -32 R0
SYMATTR InstName R4
SYMATTR Value 150K
SYMBOL res 1232 96 R0
SYMATTR InstName R5
SYMATTR Value 20K
SYMBOL res 1232 208 R0
SYMATTR InstName R6
SYMATTR Value 56K
SYMBOL FDV301N 1344 112 R0
SYMATTR InstName U2
SYMBOL res 1200 288 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value 0.1
SYMBOL res 2160 64 R0
SYMATTR InstName Rload
SYMATTR Value 15
SYMBOL Parts_TCO\\TLV431 1056 112 R0
SYMATTR InstName U1
SYMBOL res 1040 -160 R0
SYMATTR InstName R7
SYMATTR Value 2K
SYMBOL AutoGenerated\\DMP2035U 816 -96 M270
SYMATTR InstName U3
SYMBOL cap 544 -16 R0
SYMATTR InstName C1
SYMATTR Value 10µ
SYMBOL res 544 144 R0
SYMATTR InstName R8
SYMATTR Value 150K
SYMBOL FDV301N 688 48 R0
WINDOW 3 75 53 VRight 2
SYMATTR InstName U4
SYMBOL cap 608 -16 R0
SYMATTR InstName C2
SYMATTR Value 10µ
SYMBOL res 544 112 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R9
SYMATTR Value 2K
SYMBOL res 1040 -48 R0
SYMATTR InstName R3
SYMATTR Value 2K
SYMBOL res 624 -160 R0
SYMATTR InstName R10
SYMATTR Value 150K
SYMBOL FDV301N 864 -112 M90
WINDOW 3 75 53 VRight 2
SYMATTR InstName U5
SYMBOL schottky 768 -48 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D1
SYMATTR Value BAT46WJ
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL Parts_TCO\\TLV431 1824 112 R0
SYMATTR InstName U6
SYMBOL res 1984 -80 R0
SYMATTR InstName R2
SYMATTR Value 62K
SYMBOL res 1984 160 R0
SYMATTR InstName R11
SYMATTR Value 18K
SYMBOL res 1808 -80 R0
SYMATTR InstName R12
SYMATTR Value 2K
SYMBOL LED 1616 144 R0
SYMATTR InstName D2
SYMATTR Value NSCW100
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL FDV301N 1680 -32 M0
SYMATTR InstName U7
SYMBOL res 1616 -144 R0
SYMATTR InstName R14
SYMATTR Value 390
TEXT 32 344 Left 2 !.dc VIN 5V 8V
TEXT 168 -536 Left 2 ;User resets the circuit by pressing the momentary switch, which discharges C1+C2.
TEXT 168 -504 Left 2 ;U4 then becomes low, this turns on VOUT to 5V.  In the mean time C1 and C2 are charging.
TEXT 168 -472 Left 2 ;When C1+C2 have enough charge, U4 will become high.
TEXT 168 -440 Left 2 ;If the user turns on the load before U4 becomes high, then there will be a voltage drop across R1.
TEXT 168 -408 Left 2 ;If the voltage drop is big enough (e.g. 300mA load), then U1 will conduct and pull the gate of U3 low.
TEXT 328 360 Left 2 ;TLV431 trigger voltage = 1.24V
TEXT 328 392 Left 2 ;V(R1)=0.1V at full load, V(R1)=30mV at lower load. Set trigger on 15mV over R1
TEXT 328 424 Left 2 ;V(U2)=V(trigger)-V(R1), 1.240 - 0.015 = 1.225V
TEXT 328 456 Left 2 ;Tuning of V(U2) can be done by changing R4.  But (R5+R6)/(R4+R5+R6) * Vout must be >  1.24V
TEXT -24 184 Left 2 ;5V < VIN <8V
TEXT 168 -376 Left 2 ;U5 avoids leakage currents through the current sensing circuit when VOUT is not on.
TEXT 168 -344 Left 2 ;D1 prevents that U4 disables the current measurement when it's on.
TEXT 328 488 Left 2 ;So R4 < 230K
TEXT 328 520 Left 2 ;V(R6) = 909.5mV in simulation.
TEXT 1640 408 Left 2 ;Under voltage indication.
TEXT 1640 440 Left 2 ;VIN < 5.5V then LED = ON
